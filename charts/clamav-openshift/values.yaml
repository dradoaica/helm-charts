global:
  # -- Global container image registry override
  imageRegistry: ""
  # -- Global pod image pull secrets
  imagePullSecrets: [ ]

# -- String to partially override the fullname template with a string (will prepend the release name)
nameOverride: ""
# -- String to fully override the fullname template with a string
fullnameOverride: ""

# -- Additional labels to add to all resources
labels: { }
# -- Additional labels to add to pods
podLabels: { }

# -- Annotations to add to all resources
annotations: { }
# -- Additional annotations to add to pods
podAnnotations: { }

# -- Extra init containers to inject into the main Pod spec
extraInitContainers: [ ]
# -- Extra sidecar containers to inject into the main Pod spec
extraContainers: [ ]
# -- Extra volumes to add to the main Pod spec
extraVolumes: [ ]
# -- Extra volume mounts to add to the main container
extraVolumeMounts: [ ]
# -- Extra environment variables to inject into the main container
extraEnvVars: [ ]
# -- Extra envFrom entries to inject into the main container
extraEnvFrom: [ ]
# -- Name of a ConfigMap with extra environment variables to inject into the main container
extraEnvVarsCM: ""
# -- Name of a Secret with extra environment variables to inject into the main container
extraEnvVarsSecret: ""

image:
  # -- Main container image registry
  registry: docker.io
  # -- Main container image repository
  repository: dradoaica/clamav-openshift
  # -- Main container image tag
  tag: ""
  # -- Main container image pull policy
  pullPolicy: IfNotPresent

serviceAccount:
  # -- Create a dedicated ServiceAccount
  create: true
  # -- Name for the ServiceAccount (autogenerated when empty)
  name: ""
  # -- Additional annotations to add to ServiceAccount
  annotations: { }

# -- StatefulSet pod management policy
podManagementPolicy: OrderedReady
# -- Number of old ReplicaSets to retain
revisionHistoryLimit: 10

# -- StatefulSet update strategy
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    partition: 0

# -- Pod priority class name
priorityClassName: ""

# -- Pod termination grace period
terminationGracePeriodSeconds: 60

# -- Pod security context configuration
podSecurityContext:
  # -- Enable pod security context
  enabled: true
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true
  fsGroup: 1001

# -- Container security context configuration
containerSecurityContext:
  # -- Enable container security context
  enabled: true
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true
  privileged: false
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ "ALL" ]
  seccompProfile:
    type: "RuntimeDefault"

# -- Main container requests/limits
resources:
  requests:
    cpu: 300m
    memory: 2Gi
  limits:
    cpu: "2"
    memory: 4Gi

# -- Liveness probe configuration
livenessProbe:
  # -- Enable liveness probe
  enabled: true
  exec:
    command:
      - /usr/local/bin/clamdcheck.sh
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# -- Readiness probe configuration
readinessProbe:
  # -- Enable readiness probe
  enabled: true
  exec:
    command:
      - /usr/local/bin/clamdcheck.sh
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# -- Startup probe configuration
startupProbe:
  # -- Enable startup probe
  enabled: true
  exec:
    command:
      - /usr/local/bin/clamdcheck.sh
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# -- Lifecycle hooks configuration
lifecycleHooks: { }

container:
  # -- Container ports used by the Pod spec and as Service targetPort values
  ports:
    clamd: 3310
    milter: 7357

service:
  # -- Service type (ClusterIP, NodePort, LoadBalancer)
  type: ClusterIP
  # -- Service ports used by the Service spec. targetPort fields reference container.ports.*
  ports:
    # -- Service port for ClamD
    clamd: 3310
    # -- Service port for Milter
    milter: 7357
  nodePorts:
    # -- NodePort value for ClamD when service.type is NodePort
    clamd: ""
    # -- NodePort value for Milter when service.type is NodePort
    milter: ""

# -- Persistence is always enabled
persistence:
  persistentVolumeClaimRetentionPolicy:
    # -- Enable persistent volume retention policy
    enabled: false
    # -- Volume retention behavior when the replica count of the StatefulSet is reduced
    whenScaled: Retain
    # -- Volume retention behavior that applies when the StatefulSet is deleted
    whenDeleted: Retain
  # -- Persistent volume size for virus signature databases
  size: 2Gi
  # -- Persistent volume storage class (empty string uses cluster default)
  storageClass: ""
  # -- Persistent volume access modes
  accessModes:
    - ReadWriteOnce
  # -- Labels to add to the PersistentVolumeClaim
  labels: { }
  # -- Annotations to add to the PersistentVolumeClaim
  annotations: { }

# -- Node selector
nodeSelector: { }
# -- Node tolerations
tolerations: [ ]
# -- Node affinity
affinity: { }
# -- Topology spread constraints
topologySpreadConstraints: [ ]

networkPolicy:
  # -- Create a NetworkPolicy
  create: false
  # -- Name for the NetworkPolicy (defaults to fullname when empty)
  name: ""
  # -- NetworkPolicy ingress rules
  ingress: [ ]
  # -- NetworkPolicy egress rules
  egress:
    # Allow DNS resolution
    - to:
        - ipBlock: { cidr: 0.0.0.0/0 }
      ports:
        - port: 53
          protocol: UDP
        - port: 53
          protocol: TCP
    # Allow HTTP/HTTPS for database updates
    - to:
        - ipBlock: { cidr: 0.0.0.0/0 }
      ports:
        - port: 80
          protocol: TCP
        - port: 443
          protocol: TCP

podDisruptionBudget:
  # -- Create a PodDisruptionBudget for high availability
  create: false
  # -- Minimum number of pods that must be available during disruptions (mutually exclusive with maxUnavailable)
  minAvailable: 1
  # -- Maximum number of pods that can be unavailable during disruptions (mutually exclusive with minAvailable)
  maxUnavailable: ""
  # Alternatively, use maxUnavailable (mutually exclusive with minAvailable)
  # maxUnavailable: "50%"

autoscaling:
  # -- Create a HorizontalPodAutoscaler
  create: false
  # -- Minimum number of replicas
  minReplicas: 1
  # -- Maximum number of replicas
  maxReplicas: 10
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80

# App specific
# -- Number of pods
replicaCount: 1

milter:
  # -- Enable Milter
  enabled: false
  # -- Maximum file size to scan (in MB)
  maxFileSize: 25

clamd:
  # -- Maximum length the queue of pending connections may grow to
  maxConnectionQueueLength: 100
  # -- Close the connection when the data size limit is exceeded. The value should match your MTA's limit for a maximum attachment size
  streamMaxLength: 100
  # -- Maximum number of threads running at the same time
  maxThreads: 4
  # -- Maximum number of queued items (including those being processed by MaxThreads threads)
  maxQueue: 100
  # -- Time to wait (in milliseconds) if send buffer is full (keep low to avoid clamd hanging)
  sendBufTimeout: 500
  # -- Maximum scan size permitted (in MB)
  maxScanSize: 100
  # -- Maximum file size to scan (in MB)
  maxFileSize: 25

freshclam:
  # -- ClamAV database mirror servers
  mirrors: database.clamav.net
  # -- Number of database checks per day
  checks: 24
  # -- HTTP proxy host for freshclam updates
  httpProxyHost: ""
  # -- HTTP proxy port for freshclam updates
  httpProxyPort: ""
  # -- HTTP proxy username for freshclam updates
  httpProxyUsername: ""
  # -- HTTP proxy password for freshclam updates
  httpProxyPassword: ""

# -- Environment variables
env: { }
